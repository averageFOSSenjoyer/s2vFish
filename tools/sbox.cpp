#include <vector>
#include <iostream>

int main(int argc, char** argv) {
    std::vector<uint8_t> lut ={
    0x8, 0x1, 0x7, 0xD, 0x6, 0xF, 0x3, 0x2, 0x0, 0xB, 0x5, 0x9, 0xE, 0xC, 0xA, 0x4,
    0xE, 0xC, 0xB, 0x8, 0x1, 0x2, 0x3, 0x5, 0xF, 0x4, 0xA, 0x6, 0x7, 0x0, 0x9, 0xD,
    0xB, 0xA, 0x5, 0xE, 0x6, 0xD, 0x9, 0x0, 0xC, 0x8, 0xF, 0x3, 0x2, 0x4, 0x7, 0x1,
    0xD, 0x7, 0xF, 0x4, 0x1, 0x2, 0x6, 0xE, 0x9, 0xB, 0x3, 0x0, 0x8, 0x5, 0xC, 0xA,
    0x2, 0x8, 0xB, 0xD, 0xF, 0x7, 0x6, 0xE, 0x3, 0x1, 0x9, 0x4, 0x0, 0xA, 0xC, 0x5,
    0x1, 0xE, 0x2, 0xB, 0x4, 0xC, 0x3, 0x7, 0x6, 0xD, 0xA, 0x5, 0xF, 0x9, 0x0, 0x8,
    0x4, 0xC, 0x7, 0x5, 0x1, 0x6, 0x9, 0xA, 0x0, 0xE, 0xD, 0x8, 0x2, 0xB, 0x3, 0xF,
    0xB, 0x9, 0x5, 0x1, 0xC, 0x3, 0xD, 0xE, 0x6, 0x4, 0x7, 0xF, 0x2, 0x0, 0x8, 0xA
    };

    uint8_t init = 0x01;
    uint8_t a = (init & 0xF0) >> 4;
    uint8_t b = init & 0x0F;
    uint8_t a1, b1, a2, b2, a3, b3, a4, b4;
    a4 = a;
    b4 = b;

    std::vector<uint8_t> q = {1, 1, 0};

    for (auto i : q) {
        a1 = a4 ^ b4;
        b1 = a4 ^ (((b4 & 0x01) << 3) | b4 >> 1) ^ ((a4 << 3) & 0x08);
        a2 = lut[a1 + i * 64];
        b2 = lut[b1 + 16 + i * 64];
        a3 = a2 ^ b2;
        b3 = a2 ^ (((b2 & 0x01) << 3) | b2 >> 1) ^ ((a2 << 3) & 0x08);
        a4 = lut[a3 + 32 + i * 64];
        b4 = lut[b3 + 48 + i * 64];
    }

    std::cout << std::hex << ((a4 << 4) | b4) << std::endl;
}

// g++ sbox.cpp -o sbox